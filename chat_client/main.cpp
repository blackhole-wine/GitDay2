#include "httplib.h"   // cpp-httplib ライブラリ
#include <iostream>    // 標準入出力
#include <string>      // std::string

int main() {
    // ==============================
    // サーバーに接続するクライアントを作成
    // localhost の 8080 ポートに接続
    // ==============================
    httplib::Client client("localhost", 8080);

    // ==============================
    // チャットループ
    // ==============================
    while (true) {
        // ==============================
        // コンソール画面をクリア（Windows）
        // ==============================
        system("cls");  // Windows限定、Mac/Linuxなら "clear"

        // ==============================
        // ヘッダ表示
        // ==============================
        std::cout << "=== Chat ===\n\n";

        // ==============================
        // サーバーからメッセージを取得
        // ==============================
        auto res = client.Get("/messages");
        if (res) {  // レスポンスがある場合
            std::cout << res->body << "\n";  // 取得したメッセージを表示
        }

        // ==============================
        // 入力待ち
        // ==============================
        std::cout << "> ";
        std::string input;
        std::getline(std::cin, input);  // 1行丸ごと取得（日本語OK）

        // ==============================
        // exit で終了
        // ==============================
        if (input == "exit") break;

        // ==============================
        // 入力が空でなければ送信
        // ==============================
        if (!input.empty())
        {
            // 送信文字列を作成
            std::string send = input;

            // POSTでサーバーに送信
            client.Post("/send", send, "text/plain");
        }
    }
}